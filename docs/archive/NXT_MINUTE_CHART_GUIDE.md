# NXT ë¶„ë´‰ ì°¨íŠ¸ ì¡°íšŒ ê°€ì´ë“œ

## ğŸ“Œ ê°œìš”

v6.0ë¶€í„° **NXT ì‹œê°„ëŒ€**(í”„ë¦¬ë§ˆì¼“ 08:00-09:00, ì• í”„í„°ë§ˆì¼“ 15:30-20:00)ì— ë¶„ë´‰ ì°¨íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. **ìë™ NXT ì‹œê°„ëŒ€ ê°ì§€**
ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ì„ í™•ì¸í•˜ì—¬ NXT ì‹œê°„ëŒ€ì¸ì§€ íŒë‹¨í•©ë‹ˆë‹¤.

### 2. **_NX ì ‘ë¯¸ì‚¬ ìë™ ì²˜ë¦¬**
NXT ì‹œê°„ëŒ€ì—ëŠ” ì¢…ëª©ì½”ë“œì— `_NX` ì ‘ë¯¸ì‚¬ë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ì—¬ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

ì˜ˆ: `005930` â†’ `005930_NX`

### 3. **ìë™ Fallback**
`_NX` ì ‘ë¯¸ì‚¬ë¡œ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ, ìë™ìœ¼ë¡œ ê¸°ë³¸ ì¢…ëª©ì½”ë“œë¡œ ì¬ì‹œë„í•©ë‹ˆë‹¤.

### 4. **ê³¼ê±° ë°ì´í„° ì¡°íšŒ**
`base_date` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³¼ê±° íŠ¹ì •ì¼ì˜ ë¶„ë´‰ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ’¡ ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì‚¬ìš©

```python
from api.market.chart_data import ChartDataAPI

# 1ë¶„ë´‰ ì¡°íšŒ (NXT ìë™ ì „í™˜)
chart_data = chart_api.get_minute_chart(
    stock_code="005930",  # ì‚¼ì„±ì „ì
    interval=1,           # 1ë¶„ë´‰
    count=100,            # 100ê°œ
    adjusted=True         # ìˆ˜ì •ì£¼ê°€ ë°˜ì˜
)

for candle in chart_data:
    print(f"{candle['date']} {candle['time']}: {candle['close']:,}ì›")
    print(f"ì¶œì²˜: {candle['source']}")  # 'nxt_chart', 'nxt_chart_fallback', 'regular_chart'
```

### NXT ì „ìš© ëª¨ë“œ (Fallback ë¹„í™œì„±í™”)

NXT ì ‘ë¯¸ì‚¬(`_NX`)ë¡œë§Œ ì¡°íšŒí•˜ê³ , ì‹¤íŒ¨í•´ë„ ê¸°ë³¸ ì½”ë“œë¡œ ì¬ì‹œë„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```python
# NXT ì „ìš© ëª¨ë“œ
chart_data = chart_api.get_minute_chart(
    stock_code="005930",
    interval=5,
    count=50,
    adjusted=True,
    use_nxt_fallback=False  # âš ï¸ Fallback ë¹„í™œì„±í™”
)

# ì„±ê³µ ì‹œ: source='nxt_chart'
# ì‹¤íŒ¨ ì‹œ: ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
```

### ê³¼ê±° ë°ì´í„° ì¡°íšŒ

íŠ¹ì • ë‚ ì§œì˜ ë¶„ë´‰ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

```python
# 2025ë…„ 11ì›” 6ì¼ ë°ì´í„° ì¡°íšŒ
chart_data = chart_api.get_minute_chart(
    stock_code="005930",
    interval=15,           # 15ë¶„ë´‰
    count=200,
    adjusted=True,
    base_date="20251106"   # YYYYMMDD í˜•ì‹
)
```

### Standalone Function ì‚¬ìš©

```python
from api.market.chart_data import get_minute_chart

# ChartDataAPI ì¸ìŠ¤í„´ìŠ¤ ì—†ì´ë„ ì‚¬ìš© ê°€ëŠ¥
chart_data = get_minute_chart(
    stock_code="035420",   # NAVER
    interval=30,           # 30ë¶„ë´‰
    count=50,
    adjusted=True,
    base_date="20251105",
    use_nxt_fallback=True
)
```

---

## ğŸ• NXT ì‹œê°„ëŒ€

### í”„ë¦¬ë§ˆì¼“ (Pre-market)
- **ì‹œê°„**: ì˜¤ì „ 08:00 - 09:00
- **íŠ¹ì§•**: ì •ê·œ ì¥ ê°œì¥ ì „ ê±°ë˜

### ì• í”„í„°ë§ˆì¼“ (After-market)
- **ì‹œê°„**: ì˜¤í›„ 15:30 - 20:00
- **íŠ¹ì§•**: ì •ê·œ ì¥ ì¢…ë£Œ í›„ ê±°ë˜

### ì •ê·œì¥ (Regular Hours)
- **ì‹œê°„**: ì˜¤ì „ 09:00 - ì˜¤í›„ 15:30
- **íŠ¹ì§•**: ì¼ë°˜ ê±°ë˜ ì‹œê°„ (_NX ì‚¬ìš© ì•ˆ í•¨)

---

## ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ (source í•„ë“œ)

ë°˜í™˜ëœ ë¶„ë´‰ ë°ì´í„°ì˜ `source` í•„ë“œë¡œ ë°ì´í„° ì¶œì²˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| source ê°’ | ì˜ë¯¸ |
|-----------|------|
| `nxt_chart` | NXT ì‹œê°„ëŒ€ì— _NX ì ‘ë¯¸ì‚¬ë¡œ ì„±ê³µì ìœ¼ë¡œ ì¡°íšŒ |
| `nxt_chart_fallback` | NXT ì‹œê°„ëŒ€ì— _NX ì‹¤íŒ¨ í›„ ê¸°ë³¸ ì½”ë“œë¡œ ì¡°íšŒ |
| `regular_chart` | ì •ê·œì¥ ì‹œê°„ëŒ€ì— ê¸°ë³¸ ì½”ë“œë¡œ ì¡°íšŒ |

```python
chart_data = get_minute_chart("005930", interval=1)

if chart_data:
    source = chart_data[0]['source']

    if source == 'nxt_chart':
        print("âœ… NXT ì „ìš© ë°ì´í„° ì¡°íšŒ ì„±ê³µ")
    elif source == 'nxt_chart_fallback':
        print("âš ï¸ NXT ì‹¤íŒ¨ - ê¸°ë³¸ ì½”ë“œë¡œ ì¡°íšŒë¨")
    else:
        print("ğŸ“Š ì •ê·œì¥ ë°ì´í„°")
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. NXT ì‹œê°„ëŒ€ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸

```bash
# NXT ì‹œê°„ëŒ€ì— ì‹¤í–‰ (08:00-09:00 ë˜ëŠ” 15:30-20:00)
python tests/manual/test_nxt_minute_chart.py
```

### 2. ê¸°ì¡´ ë¶„ë´‰ í…ŒìŠ¤íŠ¸ (ì¥ì™¸ ì‹œê°„)

```bash
# ì¥ì™¸ ì‹œê°„ì—ë„ ì‹¤í–‰ ê°€ëŠ¥ (ì‹¤ì‹œê°„ ë°ì´í„°ëŠ” ì—†ìŒ)
python tests/manual/test_minute_chart_multi_method.py
```

### 3. ì˜ˆìƒ ê²°ê³¼

#### NXT ì‹œê°„ëŒ€ (08:00-09:00, 15:30-20:00)

```
ğŸŒ† NXT ì‹œê°„ëŒ€ ê°ì§€ - 005930ì— _NX ì ‘ë¯¸ì‚¬ë¡œ ë¶„ë´‰ ì¡°íšŒ ì‹œë„
âœ… 005930_NX NXT 1ë¶„ë´‰ 50ê°œ ì¡°íšŒ ì„±ê³µ!

ìµœì‹  ë°ì´í„°:
  ì‹œê°„: 20251107 083000
  OHLC: 58,000 / 58,200 / 57,900 / 58,100
  ê±°ë˜ëŸ‰: 1,234
  ì¶œì²˜: nxt_chart
```

#### ì •ê·œì¥ ì‹œê°„ëŒ€ (09:00-15:30)

```
âœ… 005930 ì •ê·œì¥ 1ë¶„ë´‰ 100ê°œ ì¡°íšŒ ì™„ë£Œ

ì¶œì²˜: regular_chart
```

#### ì¥ì™¸ ì‹œê°„ (20:00-08:00)

```
âš ï¸ 005930 1ë¶„ë´‰ ì‘ë‹µì€ ì„±ê³µí–ˆì§€ë§Œ ë°ì´í„° ì—†ìŒ

í•´ê²°ì±…:
1. base_date íŒŒë¼ë¯¸í„°ë¡œ ê³¼ê±° ë°ì´í„° ì¡°íšŒ
2. NXT/ì •ê·œì¥ ì‹œê°„ëŒ€ì— ì¬ì‹œë„
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q1. NXT ì‹œê°„ëŒ€ì¸ë°ë„ ë°ì´í„°ê°€ ì•ˆ ë‚˜ì™€ìš”

**ì›ì¸**: ì¼ë¶€ ì¢…ëª©ì€ NXT ê±°ë˜ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•´ê²°ì±…**:
```python
# use_nxt_fallback=True (ê¸°ë³¸ê°’)ë¡œ ìë™ fallback í™œì„±í™”
chart_data = get_minute_chart(
    "005930",
    interval=5,
    use_nxt_fallback=True  # âœ… ê¶Œì¥
)
```

### Q2. ì¥ì™¸ ì‹œê°„ì— í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì–´ìš”

**í•´ê²°ì±…**: `base_date` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

```python
from utils.trading_date import get_last_trading_date

# ìµœê·¼ ê±°ë˜ì¼ ë°ì´í„° ì¡°íšŒ
last_date = get_last_trading_date()

chart_data = get_minute_chart(
    "005930",
    interval=1,
    base_date=last_date  # ê³¼ê±° ë°ì´í„° ì¡°íšŒ
)
```

### Q3. _NX ì„±ê³µë¥ ì´ ë‚®ì•„ìš”

**í˜„í™©** (v6.0 ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼):
- í˜„ì¬ê°€ API (_NX): 70% ì„±ê³µë¥ 
- í˜¸ê°€ API (_NX): 90% ì„±ê³µë¥  â­
- **ë¶„ë´‰ API (_NX): í…ŒìŠ¤íŠ¸ í•„ìš”** ğŸ§ª

**ê¶Œì¥ì‚¬í•­**:
1. NXT ì‹œê°„ëŒ€ì— ì§ì ‘ í…ŒìŠ¤íŠ¸í•˜ì—¬ ì„±ê³µë¥  í™•ì¸
2. `use_nxt_fallback=True`ë¡œ ìë™ fallback í™œì„±í™” (ê¸°ë³¸ê°’)

---

## ğŸ“ API íŒŒë¼ë¯¸í„° ì •ë¦¬

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---------|------|--------|------|
| `stock_code` | str | (í•„ìˆ˜) | ì¢…ëª©ì½”ë“œ (ì˜ˆ: "005930") |
| `interval` | int | 1 | ë¶„ë´‰ ê°„ê²© (1, 5, 15, 30, 60) |
| `count` | int | 100 | ì¡°íšŒí•  ë°ì´í„° ê°œìˆ˜ |
| `adjusted` | bool | True | ìˆ˜ì •ì£¼ê°€ ë°˜ì˜ ì—¬ë¶€ |
| `base_date` | str | None | ê¸°ì¤€ì¼ (YYYYMMDD, None=ë‹¹ì¼) |
| `use_nxt_fallback` | bool | True | NXT ì‹¤íŒ¨ ì‹œ fallback ì—¬ë¶€ |

---

## ğŸ¯ ê¶Œì¥ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

```python
# NXT ì‹œê°„ëŒ€ ìë™ ê°ì§€ + fallback í™œì„±í™”
chart_data = get_minute_chart("005930", interval=1)
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: NXT ì „ìš© ë¶„ì„

```python
# NXT ë°ì´í„°ë§Œ í•„ìš”í•œ ê²½ìš°
chart_data = get_minute_chart(
    "005930",
    interval=5,
    use_nxt_fallback=False
)

if not chart_data:
    print("NXT ë°ì´í„° ì—†ìŒ - ë¶„ì„ ìŠ¤í‚µ")
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë°±í…ŒìŠ¤íŒ…

```python
from datetime import datetime, timedelta

# ìµœê·¼ 5ì¼ê°„ ë°ì´í„° ìˆ˜ì§‘
dates = []
for i in range(5):
    date = (datetime.now() - timedelta(days=i)).strftime("%Y%m%d")
    dates.append(date)

all_data = {}
for date in dates:
    chart_data = get_minute_chart(
        "005930",
        interval=15,
        count=500,
        base_date=date
    )
    all_data[date] = chart_data
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™” íŒ

1. **ë¶„ë´‰ ê°„ê²© ì„ íƒ**
   - ë‹¨ê¸° ëª¨ë‹ˆí„°ë§: 1ë¶„ë´‰ (ë°ì´í„° ë§ìŒ)
   - ì¤‘ê¸° ë¶„ì„: 5ë¶„ë´‰, 15ë¶„ë´‰ (ê· í˜•)
   - ì¥ê¸° ë¶„ì„: 30ë¶„ë´‰, 60ë¶„ë´‰ (ë°ì´í„° ì ìŒ)

2. **count ì¡°ì ˆ**
   - ìµœì†Œí•œì˜ ë°ì´í„°ë§Œ ìš”ì²­ (API ë¶€í•˜ ê°ì†Œ)
   - ì˜ˆ: ìµœê·¼ 30ê°œë§Œ í•„ìš”í•˜ë©´ `count=30`

3. **fallback ë¹„í™œì„±í™”**
   - NXT ì „ìš© ë¶„ì„ ì‹œ `use_nxt_fallback=False`ë¡œ ë¶ˆí•„ìš”í•œ ì¬ì‹œë„ ë°©ì§€

---

## ğŸ“š ê´€ë ¨ íŒŒì¼

- **êµ¬í˜„**: `api/market/chart_data.py`
- **í…ŒìŠ¤íŠ¸**: `tests/manual/test_nxt_minute_chart.py`
- **ìœ í‹¸ë¦¬í‹°**: `utils/trading_date.py` (is_nxt_hours í•¨ìˆ˜)
- **ë©”ì¸ API**: `api/market/market_data.py` (í˜„ì¬ê°€/í˜¸ê°€ NXT ì§€ì›)

---

## ğŸ”„ ì—…ë°ì´íŠ¸ íˆìŠ¤í† ë¦¬

### v6.0 (2025-11-07)
- âœ… NXT ì‹œê°„ëŒ€ ìë™ ê°ì§€ ê¸°ëŠ¥ ì¶”ê°€
- âœ… _NX ì ‘ë¯¸ì‚¬ ìë™ ì²˜ë¦¬ ë° fallback
- âœ… base_date íŒŒë¼ë¯¸í„°ë¡œ ê³¼ê±° ë°ì´í„° ì¡°íšŒ ì§€ì›
- âœ… source í•„ë“œë¡œ ë°ì´í„° ì¶œì²˜ ì¶”ì 

### v5.9
- ë¶„ë´‰ ì°¨íŠ¸ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ (1/5/15/30/60ë¶„)
- ë‹¤ì¤‘ ì‹œê°„í”„ë ˆì„ ì¼ê´„ ì¡°íšŒ

---

## ğŸ’¬ ë¬¸ì˜ ë° í”¼ë“œë°±

NXT ë¶„ë´‰ ì¡°íšŒ ê´€ë ¨ ë¬¸ì œê°€ ìˆìœ¼ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

1. ë¡œê·¸ íŒŒì¼ í™•ì¸ (`logger.info` ì¶œë ¥)
2. API ì‘ë‹µ ì½”ë“œ í™•ì¸ (`return_code`)
3. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‹¤í–‰ ê²°ê³¼ í™•ì¸

**ì¤‘ìš”**: NXT ì‹œê°„ëŒ€ì— ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸í•´ì•¼ ì •í™•í•œ ì„±ê³µë¥ ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ§ª
