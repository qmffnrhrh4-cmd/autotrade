# NXT ν”„λ¦¬λ§μΌ“ ν„μ¬κ°€ μ΅°ν μΆ…ν•© ν…μ¤νΈ

μ¤μ „ 8μ‹~9μ‹ NXT ν”„λ¦¬λ§μΌ“ μ‹κ°„λ€μ— ν„μ¬κ°€ μ΅°νκ°€ μ‹¤ν¨ν•λ” λ¬Έμ λ¥Ό μ§„λ‹¨ν•κΈ° μ„ν• μΆ…ν•© ν…μ¤νΈ

## π“‹ κ°μ”

μ΄ ν…μ¤νΈλ” **13κ°€μ§€ λ‹¤μ–‘ν• λ°©λ²•**μΌλ΅ NXT ν”„λ¦¬λ§μΌ“ μ‹κ°„λ€μ ν„μ¬κ°€λ¥Ό μ΅°νν•μ—¬, μ–΄λ–¤ λ°©λ²•μ΄ μ‘λ™ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

## π• μ‹¤ν–‰ μ‹κ°„

**λ°λ“μ‹ μ¤μ „ 8μ‹~9μ‹ μ‚¬μ΄μ— μ‹¤ν–‰ν•μ„Έμ”!**

- β… **ν”„λ¦¬λ§μΌ“**: 08:00 ~ 09:00 (κ¶μ¥)
- β… **μ• ν”„ν„°λ§μΌ“**: 15:30 ~ 20:00 (λΉ„κµ ν…μ¤νΈ)
- β **μ •κ·μ¥**: 09:00 ~ 15:30 (ν…μ¤νΈ λ¶€μ ν•©)

## π€ μ‹¤ν–‰ λ°©λ²•

```bash
# 1. μ¤μ „ 8μ‹~9μ‹ μ‚¬μ΄μ— μ‹¤ν–‰
python tests/manual/test_nxt_premarket_comprehensive.py

# 2. κ²°κ³Ό νμΌ ν™•μΈ
cat test_nxt_premarket_results_YYYYMMDD_HHMMSS.json
```

## π“ ν…μ¤νΈ ν•­λ© (μ΄ 13κ°)

### μΉ΄ν…κ³ λ¦¬ 1: μΆ…λ©μ½”λ“ ν•μ‹ λ³€ν• (3κ°)

| λ²νΈ | ν…μ¤νΈλ… | μΆ…λ©μ½”λ“ μμ‹ | μ„¤λ… |
|------|---------|--------------|------|
| 1 | κΈ°λ³Έ μΆ…λ©μ½”λ“ | `005930` | λ³€ν• μ—†μ΄ κΈ°λ³Έ μ½”λ“ |
| 2 | NXT μΆ…λ©μ½”λ“ | `005930_NX` | _NX μ ‘λ―Έμ‚¬ μ¶”κ°€ |
| 3 | SOR μΆ…λ©μ½”λ“ | `005930_AL` | _AL μ ‘λ―Έμ‚¬ μ¶”κ°€ |

### μΉ΄ν…κ³ λ¦¬ 2: dmst_stex_tp νλΌλ―Έν„° (3κ°)

| λ²νΈ | ν…μ¤νΈλ… | νλΌλ―Έν„° | μ„¤λ… |
|------|---------|----------|------|
| 4 | dmst_stex_tp=KRX | `dmst_stex_tp: "KRX"` | ν•κµ­κ±°λμ† |
| 5 | dmst_stex_tp=NXT | `dmst_stex_tp: "NXT"` | NXT μ‹μ¥ |
| 6 | dmst_stex_tp=SOR | `dmst_stex_tp: "SOR"` | Smart Order Routing |

### μΉ΄ν…κ³ λ¦¬ 3: μΆ…λ©μ½”λ“ + νλΌλ―Έν„° μ΅°ν•© (3κ°)

| λ²νΈ | ν…μ¤νΈλ… | μ΅°ν•© | μ„¤λ… |
|------|---------|------|------|
| 7 | _NX + NXT νλΌλ―Έν„° | `005930_NX` + `dmst_stex_tp: "NXT"` | κ°€μ¥ ν™•μ‹¤ν• μ΅°ν•© |
| 8 | _NX + KRX νλΌλ―Έν„° | `005930_NX` + `dmst_stex_tp: "KRX"` | κµμ°¨ ν…μ¤νΈ |
| 9 | _AL + SOR νλΌλ―Έν„° | `005930_AL` + `dmst_stex_tp: "SOR"` | SOR μ΅°ν•© |

### μΉ΄ν…κ³ λ¦¬ 4: λ‹¤λ¥Έ API μ‚¬μ© (3κ°)

| λ²νΈ | ν…μ¤νΈλ… | API | μ„¤λ… |
|------|---------|-----|------|
| 10 | νΈκ°€ API | `ka10004` | κΈ°λ³Έ νΈκ°€ μ΅°ν |
| 11 | νΈκ°€ API + _NX | `ka10004` + `005930_NX` | NXT νΈκ°€ μ΅°ν |
| 12 | μ‹κ°„μ™Έλ‹¨μΌκ°€ API | `ka10087` | μ‹κ°„μ™Έ μ „μ© API |

### μΉ΄ν…κ³ λ¦¬ 5: WebSocket (μ°Έκ³ μ©)

| λ²νΈ | ν…μ¤νΈλ… | TR | μ„¤λ… |
|------|---------|-----|------|
| 13 | μ‹¤μ‹κ°„ μ‹κ°„μ™ΈνΈκ°€ | `0E` | WebSocket μ‹¤μ‹κ°„ (λ―Έκµ¬ν„) |

## π“ ν…μ¤νΈ μΆ…λ©

κΈ°λ³Έμ μΌλ΅ λ‹¤μ μΆ…λ©μ„ ν…μ¤νΈν•©λ‹λ‹¤:

- **005930**: μ‚Όμ„±μ „μ
- **000660**: SKν•μ΄λ‹‰μ¤
- **088340**: μ‚¬μ©μ μ§€μ • μΆ…λ©

μΆ…λ© λ³€κ²½ λ°©λ²•:
```python
# test_nxt_premarket_comprehensive.py νμΌ μμ •
self.test_stocks = [
    "005930",  # μ‚Όμ„±μ „μ
    "000660",  # SKν•μ΄λ‹‰μ¤
    "YOUR_STOCK_CODE",  # μ›ν•λ” μΆ…λ© μ¶”κ°€
]
```

## π“ κ²°κ³Ό λ¶„μ„

### μ„±κ³µ μμ‹

```
β… μ„±κ³µν• ν…μ¤νΈ:
  - NXT μΆ…λ©μ½”λ“: 71,500μ› (μ¶μ²: nx_code)
  - _NX + NXT νλΌλ―Έν„°: 71,500μ› (μ¶μ²: nx_code_nxt_param)
  - νΈκ°€ API + _NX: 71,500μ› (μ¶μ²: orderbook_nx)
```

### μ‹¤ν¨ μμ‹

```
β μ‹¤ν¨ν• ν…μ¤νΈ:
  - κΈ°λ³Έ μΆ…λ©μ½”λ“: μ²΄κ²°μ •λ³΄ μ—†μ
  - dmst_stex_tp=KRX: μ²΄κ²°μ •λ³΄ μ—†μ
  - μ‹κ°„μ™Έλ‹¨μΌκ°€ API: μ‹κ°„μ™Έλ‹¨μΌκ°€ μ •λ³΄ μ—†μ
```

### κ²°κ³Ό νμΌ κµ¬μ΅°

```json
{
  "timestamp": "2025-11-05T08:30:00",
  "is_nxt_hours": true,
  "is_market_hours": false,
  "total_tests": 39,
  "successful_tests": 9,
  "failed_tests": 30,
  "summary": {
    "successful_approaches": [
      {
        "name": "NXT μΆ…λ©μ½”λ“",
        "source": "nx_code",
        "price": 71500
      }
    ]
  }
}
```

## π” λ¬Έμ  μ§„λ‹¨

### λ¨λ“  ν…μ¤νΈκ°€ μ‹¤ν¨ν•λ” κ²½μ°

1. **μ‹κ°„λ€ ν™•μΈ**
   - μ •λ§ 08:00-09:00 μ‚¬μ΄μΈκ°€?
   - `is_nxt_hours()` ν•¨μκ°€ μ λ€λ΅ μ‘λ™ν•λ”κ°€?

2. **λ„¤νΈμ›ν¬ ν™•μΈ**
   - API μ„λ²„ μ—°κ²° κ°€λ¥ν•κ°€?
   - μΈμ¦ ν† ν°μ΄ μ ν¨ν•κ°€?

3. **μΆ…λ© ν™•μΈ**
   - ν•΄λ‹Ή μΆ…λ©μ΄ NXT κ±°λ λ€μƒμΈκ°€?
   - κ±°λμ •μ§€ μΆ…λ©μ€ μ•„λ‹κ°€?

### μΌλ¶€ ν…μ¤νΈλ§ μ„±κ³µν•λ” κ²½μ°

μ„±κ³µν• ν…μ¤νΈμ **μΆ…λ©μ½”λ“ ν•μ‹**κ³Ό **νλΌλ―Έν„°**λ¥Ό ν™•μΈν•μ—¬ μ½”λ“μ— μ μ©ν•μ„Έμ”.

μ:
```python
# ν…μ¤νΈ 7λ²μ΄ μ„±κ³µν–λ‹¤λ©΄
if is_nxt_hours():
    body = {
        "stk_cd": f"{stock_code}_NX",
        "dmst_stex_tp": "NXT"
    }
```

## π› οΈ μ½”λ“ μ μ©

μ„±κ³µν• λ°©λ²•μ„ μ°Ύμ•λ‹¤λ©΄ `api/market.py`μ— μ μ©:

### 1λ‹¨κ³„: get_stock_price μμ •

```python
def get_stock_price(self, stock_code: str, use_fallback: bool = True):
    from utils.trading_date import is_nxt_hours

    # μ„±κ³µν• λ°©λ²• μ μ© (μ: ν…μ¤νΈ 7λ²)
    if is_nxt_hours():
        body = {
            "stk_cd": f"{stock_code}_NX",
            "dmst_stex_tp": "NXT"
        }
    else:
        body = {"stk_cd": stock_code}

    response = self.client.request(
        api_id="ka10003",
        body=body,
        path="stkinfo"
    )
    # ...
```

### 2λ‹¨κ³„: get_orderbook μμ •

```python
def get_orderbook(self, stock_code: str):
    from utils.trading_date import is_nxt_hours

    if is_nxt_hours():
        body = {"stk_cd": f"{stock_code}_NX"}
    else:
        body = {"stk_cd": stock_code}

    response = self.client.request(
        api_id="ka10004",
        body=body,
        path="mrkcond"
    )
    # ...
```

## π“ μ°Έκ³  λ¬Έμ„

- `kiwoom_docs/μΆ…λ©μ •λ³΄.md`: ka10003 API μƒμ„Έ μ¤ν™
- `kiwoom_docs/μ‹μ„Έ.md`: ka10004, ka10087 API μ¤ν™
- `docs/guides/NXT_TEST_GUIDE.md`: NXT μΆ…ν•© ν…μ¤νΈ κ°€μ΄λ“
- `utils/trading_date.py`: μ‹κ°„λ€ νλ³„ ν•¨μ

## β οΈ μ£Όμμ‚¬ν•­

1. **ν”„λ¦¬λ§μΌ“ vs μ• ν”„ν„°λ§μΌ“**
   - ν”„λ¦¬λ§μΌ“κ³Ό μ• ν”„ν„°λ§μΌ“μ΄ μ„λ΅ λ‹¤λ¥Έ λ°©λ²•μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤
   - λ‘ μ‹κ°„λ€ λ¨λ‘ ν…μ¤νΈν•΄λ³΄μ„Έμ”

2. **μΆ…λ©λ³„ μ°¨μ΄**
   - μΌλ¶€ μΆ…λ©μ€ NXT κ±°λκ°€ μ• λ  μ μμµλ‹λ‹¤
   - μ—¬λ¬ μΆ…λ©μΌλ΅ ν…μ¤νΈν•μ„Έμ”

3. **API μ‘λ‹µ λ³€ν™”**
   - ν‚¤μ›€μ¦κ¶ APIλ” μκ³  μ—†μ΄ λ³€κ²½λ  μ μμµλ‹λ‹¤
   - μ£ΌκΈ°μ μΌλ΅ μ¬ν…μ¤νΈκ°€ ν•„μ”ν•  μ μμµλ‹λ‹¤

## π› λ²„κ·Έ λ¦¬ν¬νΈ

ν…μ¤νΈ κ²°κ³Όλ¥Ό κ³µμ ν•΄μ£Όμ„Έμ”:

1. ν…μ¤νΈ μ‹κ°„λ€
2. μ„±κ³µν• ν…μ¤νΈ λ©λ΅
3. μ‹¤ν¨ν• ν…μ¤νΈ λ©λ΅
4. κ²°κ³Ό JSON νμΌ

## π“ λ„μ›€λ§

λ” μμ„Έν• λ‚΄μ©μ€ λ‹¤μ λ…λ Ήμ–΄λ΅ ν™•μΈ:

```bash
python tests/manual/test_nxt_premarket_comprehensive.py --help
```

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-11-05
**μ‘μ„±μ**: Claude Code Assistant
**λ©μ **: NXT ν”„λ¦¬λ§μΌ“ ν„μ¬κ°€ μ΅°ν λ¬Έμ  μ§„λ‹¨
